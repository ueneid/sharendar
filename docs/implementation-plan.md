# 実装計画書

## 概要
Sharendar MVPの実装を効率的に進めるための詳細なタスク計画です。
関数型ドメインモデリングとオフラインファーストアーキテクチャに基づき、段階的に実装します。

## 実装戦略

### アプローチ
- **ボトムアップ**: Infrastructure → Domain → Application → UI
- **段階的リリース**: 基本機能から順次追加
- **早期フィードバック**: 各機能ごとに動作確認

### 技術原則
- 関数型プログラミング（純粋関数、イミュータブル）
- 型安全性（Brand型、Result型）
- 副作用の分離（Repository Pattern）
- テスタビリティの確保

## 実装タスク

### 🔴 Phase 1: Infrastructure層 (High Priority)

#### ✅ 1. IndexedDB (Dexie.js) のセットアップとスキーマ定義 **完了**
**目的**: ローカルデータストレージの基盤構築

**詳細タスク**:
- [x] `/infrastructure/db/schema.ts` の実装
  - Dexieクラスの定義
  - テーブルスキーマの設定
  - バージョン管理
- [x] `/infrastructure/db/repository.ts` の実装
  - Repository実装クラス
  - CRUD操作のラッパー
- [x] 初期化処理とエラーハンドリング
- [x] テスト実装とVitestセットアップ

**成果物**:
- ✅ 型安全なDB操作インターフェース
- ✅ エラーハンドリング付きのRepository実装
- ✅ 包括的なテストスイート (20テスト全通過)
- ✅ fake-indexeddb使用のテスト環境

---

### 🟡 Phase 2: Application層 (High Priority)

#### 2. 家族メンバー管理のユースケース実装
**目的**: ドメインロジックとインフラ層の接続

**詳細タスク**:
- [ ] `/application/family/` ユースケース実装
  - 家族メンバー作成
  - 更新・削除
  - バリデーション統合
- [ ] ドメイン層とインフラ層の接続
- [ ] エラーハンドリングの統合

**成果物**:
- ビジネスロジックの実装
- Repository経由のデータ操作

---

#### 3. カレンダー・タスクのユースケース実装
**目的**: 各ドメインのユースケース層完成

**詳細タスク**:
- [ ] `/application/calendar/` ユースケース実装
- [ ] `/application/tasks/` ユースケース実装
- [ ] 相互依存関係の処理

**成果物**:
- 完全なApplication層
- ドメインロジックの活用

---

### 🔵 Phase 3: UI層 (Medium Priority)

#### 4. Zustand ストアの実装
**目的**: UI層での状態管理基盤構築

**詳細タスク**:
- [ ] `/lib/store/index.ts` の実装
  - ストア構造の設計
  - 各ドメインストアの分離
- [ ] `/lib/store/family-store.ts` 
  - 家族メンバー状態管理
  - Application層との接続
- [ ] `/lib/store/calendar-store.ts`
  - カレンダーイベント状態管理
- [ ] `/lib/store/task-store.ts`
  - タスク状態管理
- [ ] React統合とProvider設定

**成果物**:
- 型安全なグローバル状態管理
- Application層との統合

---

#### 5. 設定画面 (/settings) の実装
**目的**: 家族メンバー管理のUI実装

**詳細タスク**:
- [ ] `/app/settings/page.tsx` の実装
  - レスポンシブレイアウト
  - メンバーリスト表示
- [ ] 家族メンバー追加フォーム
  - バリデーション表示
  - エラーメッセージ
- [ ] 編集・削除機能
- [ ] カラーピッカー・アバター選択
- [ ] 操作フィードバック (成功/エラー表示)

**成果物**:
- 完全な家族メンバー管理UI
- バリデーション付きフォーム

---

### 🟢 Phase 4: 機能拡張 (Medium Priority)

#### 6. カレンダーコンポーネントのリファクタリング
**目的**: 既存コンポーネントの新アーキテクチャ対応

**詳細タスク**:
- [ ] `/components/Calendar.tsx` の更新
  - 新しいドメインモデル対応
  - 型安全性の向上
- [ ] ストアとの統合
- [ ] パフォーマンス最適化

**成果物**:
- 新アーキテクチャ準拠のカレンダー
- 型安全なイベント表示

---

#### 6. カレンダーイベント作成・編集機能
**目的**: イベント管理のフル機能実装

**詳細タスク**:
- [ ] イベント作成モーダル/フォーム
  - 日付・時刻入力
  - メンバー割り当て
  - バリデーション
- [ ] イベント編集機能
- [ ] イベント削除機能
- [ ] 一覧・詳細表示の改善

**成果物**:
- 完全なイベント管理機能
- ユーザーフレンドリーなUI

---

#### 7. タスク管理機能の実装
**目的**: タスクのCRUD操作とステータス管理

**詳細タスク**:
- [ ] `/app/tasks/page.tsx` の更新
  - 新ドメインモデル対応
  - フィルタリング機能
- [ ] タスク作成・編集フォーム
- [ ] ステータス変更機能
- [ ] 優先度管理
- [ ] メンバー割り当て機能

**成果物**:
- 完全なタスク管理システム
- 直感的な操作UI

---

#### 8. チェックリスト機能の実装
**目的**: タスク内チェックリストの動的管理

**詳細タスク**:
- [ ] チェックリストアイテムのCRUD
- [ ] ドラッグ&ドロップ並び替え
- [ ] 進捗率表示
- [ ] 一括操作機能

**成果物**:
- インタラクティブなチェックリスト
- 視覚的な進捗管理

---

#### 9. ダッシュボード (/) の実装
**目的**: 重要情報の集約表示

**詳細タスク**:
- [ ] `/app/page.tsx` の更新
  - 今日の予定表示
  - 緊急タスク表示
  - 完了率サマリー
- [ ] ウィジェット化
- [ ] クイックアクション機能

**成果物**:
- 情報豊富なダッシュボード
- 効率的なナビゲーション

---

### 🟢 Phase 3: 付加機能 (Low Priority)

#### 10. データの永続化とエクスポート/インポート機能
**目的**: データのバックアップ・復元機能

**詳細タスク**:
- [ ] JSON形式でのエクスポート
- [ ] インポート機能とバリデーション
- [ ] データ整合性チェック
- [ ] 設定画面への統合

**成果物**:
- データポータビリティの確保
- 簡単なバックアップ機能

---

#### 11. PWA設定の最適化
**目的**: オフライン対応とパフォーマンス向上

**詳細タスク**:
- [ ] Service Worker設定最適化
- [ ] キャッシュ戦略の改善
- [ ] オフライン表示の改善
- [ ] インストール促進

**成果物**:
- 高品質なPWA体験
- 確実なオフライン動作

---

#### 12. OCR機能の実装 (最後)
**目的**: プリント読み取り機能の実装

**詳細タスク**:
- [ ] Google Cloud Vision API連携
- [ ] 画像アップロード処理
- [ ] テキスト抽出とパース
- [ ] 結果からイベント・タスク生成
- [ ] 手動修正UI

**成果物**:
- 自動プリント読み取り機能
- 手動修正可能なUI

---

## 完了基準

各タスクの完了基準:
- [ ] 実装完了
- [ ] 型チェック通過
- [ ] Lint通過
- [ ] 基本的な動作確認
- [ ] エラーハンドリング確認
- [ ] レスポンシブ対応確認

## 進捗状況

### ✅ 完了済み
- **Task 1**: IndexedDB (Dexie.js) のセットアップとスキーマ定義
  - Infrastructure層の基盤構築完了
  - 全20テスト通過
  - 型安全なRepository実装

### 🔄 次のステップ

1. **Task 2**: 家族メンバー管理のユースケース実装 (Application層)
2. **Task 3**: カレンダー・タスクのユースケース実装
3. 段階的にPhase 3 (UI層) へ進行