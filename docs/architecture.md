# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

## æ¦‚è¦

Sharendarã¯é–¢æ•°å‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚
ä¾å­˜æ€§é€†è»¢åŸå‰‡(DIP)ã¨ä¾å­˜æ€§æ³¨å…¥(DI)ã«ã‚ˆã‚Šã€é«˜ã„ä¿å®ˆæ€§ã¨ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸå‰‡

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å®Ÿè£…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UIå±¤ (Next.js)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Applicationå±¤ (UseCase + DI)          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚           Domainå±¤ (ç´”ç²‹ãƒ­ã‚¸ãƒƒã‚¯)         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                         â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†‘ ä¾å­˜é–¢ä¿‚ã¯å†…å´ã¸ã®ã¿å‘ã‹ã†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Infrastructureå±¤ (å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ )              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾å­˜æ€§ã®æ–¹å‘

```typescript
// âœ… æ­£ã—ã„ä¾å­˜é–¢ä¿‚
UIå±¤ â†’ Applicationå±¤ â†’ Domainå±¤ â† Infrastructureå±¤
//                        â†‘
//                  Interfaceå®šç¾©ã®ã¿
//               (å®Ÿè£…ã¯Infrastructureå±¤)
```

## å±¤åˆ¥è¨­è¨ˆè©³ç´°

### Domainå±¤ï¼ˆæœ€å†…å±¤ï¼‰

**è²¬ä»»**: ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ«ãƒ¼ãƒ«

```typescript
// domain/family/types.ts - Brandå‹ã¨Value Objects
export type MemberId = string & { readonly brand: unique symbol };
export type MemberName = string & { readonly brand: unique symbol };

export type FamilyMember = Readonly<{
  id: MemberId;
  name: MemberName;
  avatar?: string;
  color: Color;
}>;

// domain/family/repository.ts - Interfaceå®šç¾©ï¼ˆDIéä¾å­˜ï¼‰
export interface IFamilyMemberRepository {
  save(member: FamilyMember): Promise<Result<void, FamilyMemberRepositoryError>>;
  findById(id: MemberId): Promise<Result<FamilyMember | null, FamilyMemberRepositoryError>>;
  // ... ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰
}

// domain/family/operations.ts - ç´”ç²‹é–¢æ•°
export const createFamilyMember = (
  name: MemberName,
  options?: CreateMemberOptions
): FamilyMember => {
  // å‰¯ä½œç”¨ã®ãªã„ç´”ç²‹ãªæ“ä½œ
};
```

**ç‰¹å¾´**:
- ä»–ã®å±¤ã«ä¾å­˜ã—ãªã„
- DIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãªã„
- ç´”ç²‹é–¢æ•°ã®ã¿ã§æ§‹æˆ
- Interfaceå®šç¾©ã«ã‚ˆã‚Šå¤–éƒ¨ä¾å­˜ã‚’æŠ½è±¡åŒ–

### Applicationå±¤ï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ï¼‰

**è²¬ä»»**: ãƒ“ã‚¸ãƒã‚¹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…ã¨DIè¨­å®š

```typescript
// application/shared/types.ts - DIã‚·ãƒ³ãƒœãƒ«ç®¡ç†
export const TYPES = {
  IFamilyMemberRepository: Symbol.for('IFamilyMemberRepository'),
  FamilyMemberUseCase: Symbol.for('FamilyMemberUseCase'),
} as const;

// application/family/use-cases.ts - UseCaseå®Ÿè£…
@injectable()
export class FamilyMemberUseCase {
  constructor(
    @inject(TYPES.IFamilyMemberRepository)
    private readonly repository: IFamilyMemberRepository
  ) {}

  async createMember(name: string): Promise<Result<FamilyMember, FamilyUseCaseError>> {
    // 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    // 2. ãƒ‰ãƒ¡ã‚¤ãƒ³æ“ä½œå‘¼ã³å‡ºã—
    // 3. Repositoryå‘¼ã³å‡ºã—
    // 4. Resultå‹ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  }
}

// application/family/index.ts - ãƒ•ã‚¡ã‚¯ãƒˆãƒªé–¢æ•°
export const getFamilyUseCase = (): FamilyMemberUseCase => {
  ensureContainerInitialized();
  return container.get<FamilyMemberUseCase>(TYPES.FamilyMemberUseCase);
};
```

**ç‰¹å¾´**:
- Domainå±¤ã®Interfaceã®ã¿ã«ä¾å­˜
- Infrastructureå±¤ã«ç›´æ¥ä¾å­˜ã—ãªã„
- DIã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ä¾å­˜æ€§è§£æ±º
- CQRSï¼ˆCommand Query Responsibility Segregationï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³

### Infrastructureå±¤ï¼ˆæœ€å¤–å±¤ï¼‰

**è²¬ä»»**: å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®æ¥ç¶šã¨å…·ä½“çš„å®Ÿè£…

```typescript
// infrastructure/db/repository.ts - Repositoryå®Ÿè£…
@injectable()
export class InjectableFamilyMemberRepository implements IFamilyMemberRepository {
  async save(member: FamilyMember): Promise<Result<void, FamilyMemberRepositoryError>> {
    try {
      // IndexedDBå…·ä½“çš„æ“ä½œ
      await db.familyMembers.put(this.toDTO(member));
      return ok(undefined);
    } catch (error) {
      return err({ type: 'DatabaseError', message: error.message });
    }
  }
}

// infrastructure/di/bindings.ts - DIè¨­å®š
export const configureContainer = (container: Container): void => {
  container.bind<IFamilyMemberRepository>(TYPES.IFamilyMemberRepository)
           .to(InjectableFamilyMemberRepository)
           .inSingletonScope();
  
  container.bind<FamilyMemberUseCase>(TYPES.FamilyMemberUseCase)
           .to(FamilyMemberUseCase)
           .inTransientScope();
};
```

**ç‰¹å¾´**:
- Domainå±¤ã®Interfaceã‚’å®Ÿè£…
- å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ï¼ˆIndexedDBã€APIç­‰ï¼‰ã¨ã®æ¥ç¶š
- DIãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¨­å®š
- DTOå¤‰æ›å‡¦ç†

### UIå±¤ï¼ˆNext.js App Routerï¼‰

**è²¬ä»»**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// app/settings/page.tsx
export default function SettingsPage() {
  const useCase = getFamilyUseCase(); // DIã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å–å¾—
  
  const handleCreateMember = async (name: string) => {
    const result = await useCase.createMember(name);
    
    if (result.isErr()) {
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      setError(result.error.message);
    } else {
      // æˆåŠŸå‡¦ç†
      setMembers(prev => [...prev, result.value]);
    }
  };

  return (
    // JSXå®Ÿè£…
  );
}
```

## ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ã®å®Ÿè£…

### DIã‚·ãƒ³ãƒœãƒ«ã®ç®¡ç†å ´æ‰€

**Applicationå±¤ã§ç®¡ç†ã™ã‚‹ç†ç”±**:

1. **é©åˆ‡ãªè²¬ä»»åˆ†é›¢**
   - Domainå±¤: ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
   - Applicationå±¤: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨DIè¨­å®š
   - Infrastructureå±¤: å…·ä½“çš„å®Ÿè£…

2. **Domainå±¤ã®ç´”ç²‹æ€§ä¿æŒ**
   - DIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãªã„
   - å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ã®ç‹¬ç«‹æ€§

```typescript
// âœ… æ­£ã—ã„é…ç½®
/application/shared/types.ts  # DIã‚·ãƒ³ãƒœãƒ«å®šç¾©
/domain/family/repository.ts  # Interfaceå®šç¾©ã®ã¿ï¼ˆDIéä¾å­˜ï¼‰
```

### DIãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

1. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚**
   ```typescript
   // app/layout.tsx
   import { initializeContainer } from '@/infrastructure/di/container';
   
   initializeContainer(); // ä¸€åº¦ã ã‘å®Ÿè¡Œ
   ```

2. **æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨**
   ```typescript
   const useCase = getFamilyUseCase(); // DIã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å–å¾—
   ```

3. **ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ä½¿ç”¨**
   ```typescript
   const mockRepository = createMockRepository();
   const useCase = createFamilyUseCase(mockRepository); // ç›´æ¥æ³¨å…¥
   ```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

### Resultå‹ã«ã‚ˆã‚‹é–¢æ•°å‹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
import { Result, ok, err } from 'neverthrow';

// âœ… ä¾‹å¤–ã‚’æŠ•ã’ãªã„ã€Resultã‚’è¿”ã™
async function createMember(name: string): Promise<Result<FamilyMember, FamilyUseCaseError>> {
  const nameResult = validateMemberName(name);
  if (nameResult.isErr()) {
    return err(nameResult.error);
  }
  
  const saveResult = await repository.save(member);
  if (saveResult.isErr()) {
    return err(saveResult.error);
  }
  
  return ok(member);
}

// ä½¿ç”¨å´
const result = await useCase.createMember('å¤ªéƒ');
if (result.isErr()) {
  console.error(result.error);
} else {
  console.log('æˆåŠŸ:', result.value);
}
```

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ãƒ†ã‚¹ãƒˆæ–¹é‡

1. **Domainå±¤**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆç´”ç²‹é–¢æ•°ï¼‰
2. **Applicationå±¤**: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆRepositoryå«ã‚€ï¼‰
3. **Infrastructureå±¤**: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã®DBï¼‰
4. **UIå±¤**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ

### DIã«ã‚ˆã‚‹ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£

```typescript
// ãƒ†ã‚¹ãƒˆã§ã®ãƒ¢ãƒƒã‚¯æ³¨å…¥ä¾‹
describe('FamilyMemberUseCase', () => {
  it('should create member successfully', async () => {
    const mockRepository = {
      save: vi.fn().mockResolvedValue(ok(undefined)),
      findById: vi.fn().mockResolvedValue(ok(null)),
      // ...
    };
    
    const useCase = createFamilyUseCase(mockRepository);
    const result = await useCase.createMember('å¤ªéƒ');
    
    expect(result.isOk()).toBe(true);
    expect(mockRepository.save).toHaveBeenCalledWith(
      expect.objectContaining({ name: 'å¤ªéƒ' })
    );
  });
});
```

## å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¤œè¨¼

### âœ… Task 2: å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ï¼ˆå®Œäº†ï¼‰

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å“è³ªæ¤œè¨¼çµæœ**:

1. **ä¾å­˜æ€§é€†è»¢åŸå‰‡(DIP)**: âœ… å®Œå…¨å®Ÿè£…
   - Applicationå±¤ãŒInfrastructureå±¤ã«ç›´æ¥ä¾å­˜ã—ãªã„
   - Domain Interfaceã®ã¿ã«ä¾å­˜

2. **ä¾å­˜æ€§æ³¨å…¥(DI)**: âœ… InversifyJSã§å®Ÿè£…
   - å‹å®‰å…¨ãªDIå®Ÿç¾
   - ãƒ†ã‚¹ãƒˆæ™‚ã®ãƒ¢ãƒƒã‚¯æ³¨å…¥å¯¾å¿œ

3. **è²¬ä»»åˆ†é›¢**: âœ… é©åˆ‡ãªå±¤åˆ†å‰²
   - Domain: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
   - Application: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
   - Infrastructure: å…·ä½“å®Ÿè£…

4. **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: âœ… 43ãƒ†ã‚¹ãƒˆå®Ÿè£…ã€å…¨ãƒ‘ã‚¹
   - çµ±åˆãƒ†ã‚¹ãƒˆå®Œå‚™
   - ãƒ¢ãƒƒã‚¯æ³¨å…¥ãƒ†ã‚¹ãƒˆ

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æˆç†Ÿåº¦**: Production Ready

### ğŸŸ¡ æ¬¡æœŸå®Ÿè£…: Calendar & Taskç®¡ç†

åŒã˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©ç”¨:
- Domain Interfaceå®šç¾©
- Application UseCaseå®Ÿè£…
- Infrastructure Repositoryå®Ÿè£…
- å®Œå…¨ãªDIçµ±åˆ

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### DIã‚³ãƒ³ãƒ†ãƒŠã®æœ€é©åŒ–

1. **Singleton vs Transient**
   - Repository: Singletonï¼ˆçŠ¶æ…‹ã‚’æŒãŸãªã„ï¼‰
   - UseCase: Transientï¼ˆçŠ¶æ…‹ã‚’æŒã¤å¯èƒ½æ€§ï¼‰

2. **é…å»¶åˆæœŸåŒ–**
   - å¿…è¦æ™‚ã«ã®ã¿DIè§£æ±º
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚é–“ã®æœ€é©åŒ–

### ãƒ¡ãƒ¢ãƒªåŠ¹ç‡

1. **ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿æ§‹é€ **
   - æ„å›³ã—ãªã„å¤‰æ›´ã‚’é˜²ã
   - äºˆæ¸¬å¯èƒ½ãªå‹•ä½œ

2. **Resultå‹ã«ã‚ˆã‚‹æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³**
   - ä¾‹å¤–å‡¦ç†ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰å‰Šæ¸›
   - ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†åŠ¹ç‡åŒ–

## å°†æ¥ã®æ‹¡å¼µæ€§

### æ–°ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ ã®æ‰‹é †

1. Domainå±¤ã§Interfaceå®šç¾©
2. Applicationå±¤ã§UseCaseå®Ÿè£…
3. Infrastructureå±¤ã§å…·ä½“å®Ÿè£…
4. DIãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¿½åŠ 
5. UIå±¤ã§ã®åˆ©ç”¨

### å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ

```typescript
// ä¾‹: Supabaseçµ±åˆæ™‚
interface ISupabaseRepository extends IFamilyMemberRepository {
  syncWithCloud(): Promise<Result<void, SyncError>>;
}

// DIãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°åˆ‡ã‚Šæ›¿ãˆã®ã¿ã§å¯¾å¿œå¯èƒ½
container.bind<IFamilyMemberRepository>(TYPES.IFamilyMemberRepository)
         .to(SupabaseFamilyMemberRepository);
```

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€Sharendarã¯é«˜ã„ä¿å®ˆæ€§ã€ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã€æ‹¡å¼µæ€§ã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚